<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue 天气查询</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>  <!-- Vue 3 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> <!-- Axios CDN -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script> <!-- ECharts CDN -->
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 400px; margin: auto; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 20px; border-radius: 10px; text-align: center; }
        .chart { width: 100%; height: 300px; margin-top: 20px; }
    </style>
</head>
<body>

<div id="app">
    <div class="container">
        <button @click="showModal = true">查询城市</button>

        <!-- 弹出窗口 -->
        <div class="modal" :class="{ show: showModal }">
            <div class="modal-content">
                <h2>输入城市</h2>
                <input v-model="city" @input="fetchCoordinates" placeholder="输入城市">
                <p v-if="latitude && longitude">🌍 纬度: {{ latitude }}, 🌎 经度: {{ longitude }}</p>
                <br>
                <button @click="showModal = false">取消</button>
                <button @click="confirmCity">确认</button>
            </div>
        </div>

        <!-- 显示天气信息 -->
        <div v-if="weatherData">
            <h2>🌤 天气信息（{{ city }}）</h2>
            <p>当前温度：{{ weatherData.current.temperature_2m }}°C</p>
            <div id="chart" class="chart"></div>
        </div>
    </div>
</div>

<script>
const app = Vue.createApp({
    data() {
        return {
            showModal: false,
            city: '',
            latitude: null,
            longitude: null,
            weatherData: null
        };
    },
    methods: {
        async fetchCoordinates() {
            if (!this.city) return;
            const apiKey = 'a5b6fe84acda49a99de7eb6d485d906d';
            const url = `https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(this.city)}&key=${apiKey}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data.results.length > 0) {
                    this.latitude = data.results[0].geometry.lat;
                    this.longitude = data.results[0].geometry.lng;
                }
            } catch (error) {
                console.error('获取经纬度失败:', error);
            }
        },
        async confirmCity() {
            if (!this.latitude || !this.longitude) return alert('加载中！');
            this.showModal = false;
            await this.fetchWeatherData();
        },
        async fetchWeatherData() {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${this.latitude}&longitude=${this.longitude}&current=temperature_2m&daily=temperature_2m_max,temperature_2m_min&timezone=auto`;
            try {
                const response = await axios.get(url);
                this.weatherData = response.data;
                this.$nextTick(() => this.drawChart());
            } catch (error) {
                console.error('获取天气数据失败:', error);
            }
        },
        drawChart() {
            if (!this.weatherData) return;
            const chart = echarts.init(document.getElementById('chart'));
            const option = {
                title: {text: '过去7天温度变化', left: 'center'},
                tooltip: {trigger: 'axis'},
                xAxis: {type: 'category', data: this.weatherData.daily.time},
                yAxis: {type: 'value'},
                series: [
                    {name: '最高温', type: 'line', data: this.weatherData.daily.temperature_2m_max},
                    {name: '最低温', type: 'line', data: this.weatherData.daily.temperature_2m_min}
                ]
            };
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }
    }
});

app.mount('#app');
</script>

</body>
</html>
